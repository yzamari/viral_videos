# Visual/Dialogue Tagging System

## Overview

The ViralAI system now uses an intelligent tagging system to separate visual descriptions from spoken dialogue. This ensures that:
- Only dialogue is sent to Text-to-Speech (TTS)
- Visual descriptions are used for video generation
- Subtitles sync properly with audio

## How It Works

### 1. AI Agents Generate Tagged Content

All AI agents (Director, Script Writer, Multi-Agent Discussion) now generate content with proper tags:

```
[VISUAL: Dragon breathing fire] DIALOGUE: The limit approaches infinity!
```

### 2. Script Processor Extracts Dialogue

The Enhanced Script Processor automatically:
- Identifies tagged content
- Extracts only DIALOGUE portions for TTS
- Preserves visual descriptions for video generation

### 3. Benefits

- **No more hardcoded filters**: The system doesn't rely on hardcoded patterns
- **Precise control**: AI agents explicitly mark what should be spoken
- **Better sync**: Audio and subtitles match perfectly
- **Visual richness**: Visual descriptions enhance video generation without affecting audio

## Format

### Basic Format
```
[VISUAL: visual description] DIALOGUE: spoken text
```

### Multiple Segments
```
[VISUAL: Opening scene] DIALOGUE: Welcome to our show!
[VISUAL: Chart appears] DIALOGUE: Look at these amazing statistics.
[VISUAL: Explosion effect] DIALOGUE: This changes everything!
```

### Complex Scenes
```
DIALOGUE: Let me show you something incredible.
[VISUAL: Dragon performs complex mathematical transformation]
DIALOGUE: As you can see, the derivative gives us the rate of change.
[VISUAL: Graph animates showing tangent line]
```

## Implementation Details

### Director Prompts
The Director now includes instructions to tag all content:
- Creative content uses tags for character actions and dialogue
- Mission-based content uses tags for visual elements and persuasive speech
- Educational content uses tags for demonstrations and explanations

### Multi-Agent Discussion
All agents in the discussion system are trained to:
- Generate properly tagged content
- Consider visual and audio elements separately
- Optimize for subtitle readability

### Script Processing
The Enhanced Script Processor:
1. Detects tagged format
2. Extracts DIALOGUE portions
3. Falls back to legacy cleaning for backward compatibility

## Migration Guide

### For Scripts
Old format:
```
"Dragon appears. 'Hello everyone!' Dragon breathes fire. 'Math is amazing!'"
```

New format (automatically generated by AI):
```
"[VISUAL: Dragon appears] DIALOGUE: Hello everyone! [VISUAL: Dragon breathes fire] DIALOGUE: Math is amazing!"
```

### For Developers
- No code changes needed for existing scripts
- System automatically handles both formats
- New scripts will use tagged format

## Best Practices

1. **Let AI handle tagging**: Don't manually add tags to mission descriptions
2. **Use clear missions**: Describe what you want, AI will add appropriate tags
3. **Trust the system**: AI agents are trained to separate visual from audio

## Examples

### Educational Content
Mission: "Teach calculus limits using dragon professor character"

AI generates:
```
[VISUAL: Dragon professor at blackboard] DIALOGUE: Welcome to calculus class!
[VISUAL: Writes limit equation] DIALOGUE: A limit describes what happens as we approach a value.
```

### Comedy Content
Mission: "Create satirical news broadcast about technology"

AI generates:
```
[VISUAL: News anchor at desk] DIALOGUE: Breaking news from Silicon Valley!
[VISUAL: Ridiculous chart appears] DIALOGUE: AI has learned to procrastinate!
```

### Action Content
Mission: "Show epic battle between good and evil"

AI generates:
```
[VISUAL: Heroes charge forward] DIALOGUE: For justice!
[VISUAL: Explosion and special effects] DIALOGUE: We will never surrender!
```

## Troubleshooting

### Issue: Visual descriptions in audio
**Solution**: Update to latest version, AI agents now properly tag content

### Issue: Missing dialogue
**Solution**: Check that mission description is clear about spoken content

### Issue: Backward compatibility
**Solution**: System automatically handles old format scripts

## Technical Details

The tagging system is implemented in:
- `src/generators/director.py` - Generates tagged scripts
- `src/agents/multi_agent_discussion.py` - Agents use tagging
- `src/generators/enhanced_script_processor.py` - Processes tags

For more information, see the source code documentation.