# ViralAI Architecture Diagrams

## 🏗️ High-Level System Architecture

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              USER INTERFACE                              │
├───────────────┬──────────────┬──────────────┬──────────────┬───────────┤
│      CLI      │   FastAPI    │   Frontend   │   Telegram   │  Discord  │
└───────┬───────┴──────┬───────┴──────┬───────┴──────┬───────┴─────┬─────┘
        │              │              │              │             │
        └──────────────┴──────────────┴──────────────┴─────────────┘
                                      │
                    ┌─────────────────▼─────────────────┐
                    │    DECISION FRAMEWORK LAYER       │
                    │  ┌─────────────────────────────┐  │
                    │  │   DecisionFramework         │  │
                    │  ├─────────────────────────────┤  │
                    │  │ • Duration decisions       │  │
                    │  │ • Platform optimization    │  │
                    │  │ • Style selection          │  │
                    │  │ • Content structure        │  │
                    │  └─────────────┬───────────────┘  │
                    └─────────────────┼─────────────────┘
                                      │
                          ┌───────────▼───────────┐
                          │   CoreDecisions       │
                          │   (Immutable State)   │
                          └───────────┬───────────┘
                                      │
        ┌─────────────────────────────┼─────────────────────────────┐
        │                             │                             │
┌───────▼────────┐          ┌────────▼────────┐          ┌─────────▼────────┐
│  AGENT LAYER   │          │ GENERATION LAYER│          │  SERVICE LAYER   │
├────────────────┤          ├─────────────────┤          ├──────────────────┤
│ LangGraph      │          │ Character Mgr   │          │ AI Service Mgr   │
│ 5 Agents       │          │ Gemini Flash    │          │ News Aggregator  │
│ State Mgmt     │          │ Veo3 Enhanced   │          │ Social Media     │
└────────────────┘          └─────────────────┘          └──────────────────┘
```

## 🤖 LangGraph Agent System Flow

```
┌────────────────────────────────────────────────────────────────┐
│                    LANGGRAPH AGENT ORCHESTRATION                │
└────────────────────────────────────────────────────────────────┘
                                   │
                          ┌────────▼────────┐
                          │   Entry Point   │
                          │ Creative Director│
                          └────────┬────────┘
                                   │
                    ┌──────────────┼──────────────┐
                    │                             │
         ┌──────────▼──────────┐      ┌──────────▼──────────┐
         │   IDEATION PHASE    │      │  Conditional Router  │
         │   Script Writer     │◄─────┤  (Dynamic Routing)   │
         └──────────┬──────────┘      └──────────────────────┘
                    │
         ┌──────────▼──────────┐
         │ CHARACTER DESIGN    │
         │ Character Designer  │
         │ (Sofia Identity)    │
         └──────────┬──────────┘
                    │
         ┌──────────▼──────────┐
         │  VISUAL PLANNING    │
         │  Visual Director    │
         │  (Kai Aesthetic)    │
         └──────────┬──────────┘
                    │
         ┌──────────▼──────────┐
         │ CONSENSUS BUILDING  │
         │ Consensus Builder   │
         │(Harmony Synthesis)  │
         └──────────┬──────────┘
                    │
            ┌───────▼───────┐
            │ State Check   │
            ├───────────────┤
            │ Consensus?    │──No──┐
            │ Max Iter?     │      │
            └───────┬───────┘      │
                 Yes│              │
                    │              │
            ┌───────▼───────┐      │
            │     END       │      │
            └───────────────┘      │
                                   │
                    └──────────────┘
                        (Loop Back)
```

## 🎭 Character Consistency Pipeline

```
┌─────────────────────────────────────────────────────────────────────┐
│                    CHARACTER CONSISTENCY PIPELINE                    │
└─────────────────────────────────────────────────────────────────────┘

PHASE 1: CHARACTER CREATION
────────────────────────────
                ┌─────────────────┐
                │  User Input     │
                │ Name + Details  │
                └────────┬────────┘
                         │
              ┌──────────▼──────────┐
              │ Character Manager   │
              │ Create Profile      │
              └──────────┬──────────┘
                         │
        ┌────────────────┼────────────────┐
        │                                 │
┌───────▼────────┐              ┌────────▼────────┐
│  Appearance    │              │  Personality    │
│  • Age         │              │  • Traits       │
│  • Ethnicity   │              │  • Voice        │
│  • Features    │              │  • Mannerisms   │
└────────────────┘              └─────────────────┘

PHASE 2: REFERENCE GENERATION
──────────────────────────────
                ┌─────────────────┐
                │ Gemini 2.5 Flash│
                │  (nano-banana)  │
                └────────┬────────┘
                         │
        ┌────────────────┼────────────────┐
        │                │                │
┌───────▼────────┐ ┌─────▼──────┐ ┌──────▼──────┐
│ Front View     │ │ Profile    │ │ Full Body   │
│ Reference      │ │ Reference  │ │ Reference   │
└────────────────┘ └────────────┘ └─────────────┘
        │                │                │
        └────────────────┼────────────────┘
                         │
                ┌────────▼────────┐
                │ Reference Cache │
                │   (3 Images)    │
                └────────┬────────┘

PHASE 3: VIDEO GENERATION
──────────────────────────
                ┌─────────────────┐
                │    Veo 3        │
                │ Enhanced Client │
                └────────┬────────┘
                         │
              ┌──────────▼──────────┐
              │  Reference Images   │
              │  + Scene Prompt     │
              └──────────┬──────────┘
                         │
              ┌──────────▼──────────┐
              │ 8-Second Video Clip │
              │ Consistent Character│
              └──────────┬──────────┘
                         │
              ┌──────────▼──────────┐
              │ Consistency Score   │
              │    Validation       │
              └─────────────────────┘
```

## 📊 Data Flow Architecture

```
┌────────────────────────────────────────────────────────────────────┐
│                          DATA FLOW DIAGRAM                         │
└────────────────────────────────────────────────────────────────────┘

INPUT SOURCES                    PROCESSING                    OUTPUT
─────────────                    ──────────                    ──────

┌──────────┐                 ┌─────────────────┐         ┌──────────────┐
│   CLI    │────────────────▶│                 │────────▶│ Video Files  │
└──────────┘                 │                 │         └──────────────┘
                            │                 │
┌──────────┐                 │   DECISION      │         ┌──────────────┐
│   API    │────────────────▶│   FRAMEWORK     │────────▶│ Metadata     │
└──────────┘                 │                 │         └──────────────┘
                            │       +          │
┌──────────┐                 │                 │         ┌──────────────┐
│ Config   │────────────────▶│   PROCESSING    │────────▶│ Characters   │
└──────────┘                 │    PIPELINE     │         └──────────────┘
                            │                 │
┌──────────┐                 │                 │         ┌──────────────┐
│ Scrapers │────────────────▶│                 │────────▶│ Session Logs │
└──────────┘                 └─────────────────┘         └──────────────┘
     │                              │
     │                              │
┌────▼──────────────────────────────▼────┐
│           SHARED STATE STORE            │
│  • Agent State (LangGraph)              │
│  • Character Profiles                   │
│  • Session Context                      │
│  • Generated Assets                     │
└─────────────────────────────────────────┘
```

## 🔄 Microservices Architecture

```
┌─────────────────────────────────────────────────────────────────────┐
│                      MICROSERVICES ARCHITECTURE                      │
└─────────────────────────────────────────────────────────────────────┘

                          ┌─────────────────┐
                          │   API GATEWAY   │
                          │   (port 8000)   │
                          └────────┬────────┘
                                   │
        ┌──────────────────────────┼──────────────────────────┐
        │                          │                          │
┌───────▼────────┐        ┌───────▼────────┐        ┌────────▼───────┐
│CHARACTER SERVICE│        │ AGENT SERVICE  │        │ VIDEO SERVICE  │
│  (port 8001)   │        │  (port 8002)   │        │  (port 8003)  │
├────────────────┤        ├────────────────┤        ├────────────────┤
│ /create        │        │ /discussion    │        │ /generate      │
│ /reference     │        │ /state         │        │ /status        │
│ /validate      │        │ /checkpoint    │        │ /download      │
└────────┬───────┘        └────────┬───────┘        └────────┬───────┘
         │                         │                          │
         │                         │                          │
┌────────▼──────────────────────────▼─────────────────────────▼────────┐
│                         SHARED INFRASTRUCTURE                         │
├────────────────────────────────────────────────────────────────────┤
│ • Redis Cache          • PostgreSQL DB       • S3/GCS Storage       │
│ • Message Queue        • Monitoring          • Service Mesh         │
└────────────────────────────────────────────────────────────────────┘
```

## 🎬 Video Generation Pipeline

```
┌─────────────────────────────────────────────────────────────────────┐
│                     VIDEO GENERATION PIPELINE                        │
└─────────────────────────────────────────────────────────────────────┘

STAGE 1: PRE-PRODUCTION
───────────────────────
     ┌──────────┐
     │  Mission │
     └─────┬────┘
           │
     ┌─────▼─────┐     ┌─────────────┐     ┌──────────────┐
     │  Agents   │────▶│   Script    │────▶│  Characters  │
     │Discussion │     │Development  │     │   Creation   │
     └───────────┘     └─────────────┘     └──────────────┘

STAGE 2: PRODUCTION
───────────────────
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│  Character   │────▶│    Scene     │────▶│    Video     │
│  References  │     │  Generation  │     │  Generation  │
└──────────────┘     └──────────────┘     └──────────────┘
      Gemini              Gemini                Veo 3

STAGE 3: POST-PRODUCTION
────────────────────────
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│     Clip     │────▶│    Audio     │────▶│    Final     │
│   Stitching  │     │    Mixing    │     │   Rendering  │
└──────────────┘     └──────────────┘     └──────────────┘
     FFmpeg           Audio Engine          Export Engine
```

## 🌐 News Aggregator System

```
┌─────────────────────────────────────────────────────────────────────┐
│                      NEWS AGGREGATOR SYSTEM                          │
└─────────────────────────────────────────────────────────────────────┘

INPUT SOURCES                 PROCESSING               OUTPUT
─────────────                 ──────────               ──────

┌────────────┐            ┌──────────────┐       ┌──────────────┐
│  Web URLs  │───────────▶│              │──────▶│   Articles   │
└────────────┘            │              │       └──────────────┘
                         │  Universal    │
┌────────────┐            │   Scraper    │       ┌──────────────┐
│  Telegram  │───────────▶│              │──────▶│    Media     │
└────────────┘            │     with     │       └──────────────┘
                         │  Playwright   │
┌────────────┐            │              │       ┌──────────────┐
│  CSV Files │───────────▶│              │──────▶│     CSV      │
└────────────┘            └──────┬───────┘       └──────────────┘
                                 │
                         ┌───────▼───────┐
                         │ Content Pool  │
                         └───────┬───────┘
                                 │
                    ┌────────────┼────────────┐
                    │            │            │
            ┌───────▼───────┐    │    ┌───────▼───────┐
            │ AI Selection  │    │    │ Media Extract │
            │  (22 Agents)  │    │    │(Link Following)│
            └───────┬───────┘    │    └───────┬───────┘
                    │            │            │
                    └────────────┼────────────┘
                                 │
                         ┌───────▼───────┐
                         │ Video Creator │
                         │ News Overlays │
                         └───────────────┘
```

## 💰 Cost Optimization Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                      COST OPTIMIZATION FLOW                          │
└─────────────────────────────────────────────────────────────────────┘

                    ┌──────────────┐
                    │ User Request │
                    └──────┬───────┘
                           │
                    ┌──────▼───────┐
                    │ Analyze Cost │
                    └──────┬───────┘
                           │
                ┌──────────┼──────────┐
                │                     │
         ┌──────▼──────┐      ┌──────▼──────┐
         │ Cheap Mode? │      │Premium Mode │
         └──────┬──────┘      └──────┬──────┘
                │                     │
         ┌──────▼──────┐      ┌──────▼──────┐
         │Cache Check  │      │Full Pipeline│
         └──────┬──────┘      └──────┬──────┘
                │                     │
    ┌───────────┼───────────┐        │
    │           │           │        │
┌───▼───┐  ┌───▼───┐  ┌────▼────┐   │
│Cached │  │Batch  │  │Generate │   │
│Assets │  │Process│  │  New    │   │
└───┬───┘  └───┬───┘  └────┬────┘   │
    │          │           │         │
    └──────────┼───────────┘         │
               │                     │
        ┌──────▼──────┐      ┌──────▼──────┐
        │ Low Quality │      │High Quality │
        │  Output     │      │   Output    │
        └─────────────┘      └─────────────┘

COST BREAKDOWN (60-min movie):
──────────────────────────────
Characters:  $1.95  (50 images @ $0.039)
Scenes:     $17.55  (450 images @ $0.039)
Videos:     $45.00  (450 clips @ $0.10)
─────────────────────────────────────────
TOTAL:      $64.50
```

## 🔐 Security & Authentication Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                    SECURITY & AUTHENTICATION                         │
└─────────────────────────────────────────────────────────────────────┘

                    ┌──────────────┐
                    │   Request    │
                    └──────┬───────┘
                           │
                    ┌──────▼───────┐
                    │ Rate Limiter │
                    └──────┬───────┘
                           │
                    ┌──────▼───────┐
                    │   Auth Check │
                    └──────┬───────┘
                           │
                ┌──────────┼──────────┐
                │                     │
         ┌──────▼──────┐      ┌──────▼──────┐
         │   Valid?    │      │   Invalid   │
         └──────┬──────┘      └──────┬──────┘
                │                     │
         ┌──────▼──────┐      ┌──────▼──────┐
         │ Permission  │      │   Reject    │
         │    Check    │      └─────────────┘
         └──────┬──────┘
                │
         ┌──────▼──────┐
         │   Process   │
         │   Request   │
         └──────┬──────┘
                │
         ┌──────▼──────┐
         │  Audit Log  │
         └─────────────┘
```

---

*These ASCII diagrams represent the complete architecture of the ViralAI system, showing data flows, component interactions, and system organization.*